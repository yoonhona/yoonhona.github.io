---
title: Go 언어의 순차적인 프로세스간의 통신(CSP)
date: 2020-07-02
category: 언어
tags:
  - Go
  - CSP
vssue: true
draft: true
---
::: tip 이 글은  
[Concurrency in Go - Go 동시성 프로그램](http://acornpub.co.kr/book/concurrency-in-go)
스터디에 참여하면서 2장 `코드 모델링: 순차적인 프로세스 간의 통신`을 요약 정리한
내용입니다.  
:::

## 동시성과 병렬성의 차이

**다른 것과 동시에 실행되는 것**을 표현할 때 종종 동시성과 병렬성을 섞어서
사용하는데,  
코드에 대해 토론하는 경우라면 일반적으로 "동시"라는 단어를 사용해야
한다.

코드를 모델링할 때 동시성과 병렬성의 차이는 객체의 추상화에 큰 영향을 미치는
것으로 밝혀졌으며, Go는 이를 최대한 활용한다.

> 동시성은 코드의 속성이고, 병렬 처리는 실행 중인 프로그램의 속성이다.

병렬로 실행하려는 의도로 작성한 코드가 **실제로 그렇게 되리라는 보장이 있는가?**  
코어가 하나뿐인 기기에서 해당 코드를 실행하면 어떻게 되는가? 실제로 병렬적으로
실행되리라 생각할 수 있지만 그렇지 않다.  
실제로는 구분할 수 없을 정도로 빠르게 순차적으로 실행된다.

여기서 몇가지 중요한 사실은

1. 우리는 병렬적인 코드를 작성하는 것이 아나라, **병렬로 실행되기를 바라면서**
   동시성 코드를 작성하는 것
2. 동시성 코드가 **실제로 병렬로 실행되는지 여부를 모를 수**도 있다.  
   프로그램의 런타임, 운영체제, 컨테어너, 가상머신과 같은 운영체제가 실행되는
   플랫폼,  
   그리고 최종적으로 CPU와 같은 추상화 계층들을 통해서만 코드가 병렬로 실행되는
   확인할 수 있다.
3. 병렬 처리인지 아닌지는 **시간, 또는 컨텍스트**에 의해 결정된다.  
 여기서 컨텐스트는 1장의 원자성이 아닌 두 개 이상의 연산이 병렬적으로 실행됐다고
 여길 수 있는 범위로 정의

이 범위는  
시분할 관점  
프로그램이 실행되는 프로세스  
해당 프로세스의 운영체제 스레드  
프로세스가 동작하는 장비 등으로 정의할 수 있고,  
컨텍스트의 정의는 동시성과 정확성의 개념과 밀접하게 관련된다.  
이게 **컨텍스트 정의가 중요한 이유**다.  
동시에 수행되는 작업은 정의된 컨텍스트에서만 정확하다. 이것은 **모두
상대적**이다.

- 장비  
  두 대의 장비에서 각각 실행되는 계산기는 다른장비에서 실행되는 프로세스의 로직에
  영향을 미치지 않을것이라 기대할 수 있다.
- 프로세스  
  한 장비의 두 개의 프로세스는 서로 영향을 주지 않을 것이라고 예상되지만,  
  정말 서로의 논리에 영향을 주지 않을까?  
  프로세스 A가 사용하는 파일을 B가 덮어쓸 수도 있고, 메모리를 침범할 수도 있다.  
  다행히도 프로세스 경계와 운영체제는 논리적인 방식으로 동시성 문제들을 생각하는
  데 도움이 된다.
- OS 스레드  
  1장에서 이야기한 레이스 컨디션, 데드락, 라이브락, 기아상태와 같은 모든 문재가
  발생

추상화의 단계가 진행될수록 무언가를 동시적으로 모델링하는 문제는 **더욱 추론하기
어려워지고 중요**해짐  
거꾸로 동시적으로 모델링이 어려워질수록 추상화는 더욱 더 중요해진다.  
하지만 우리업계 대부분의 동시성 논리는 가장 높은 추상화 수준인 OS 스레드에서
작성되어있고, 시스템이 많은 스레드를 처리할 수 없는 경우에는 스레드 풀^thread^
^pool^을 만들고 스레드 풀에 작업을 다중화해야 했다.  
[링크1. thread 이미지](https://www.educative.io/courses/java-multithreading-for-senior-engineering-interviews/m2G48X18NDO)  
[링크2. 자바 동시성 코드 리뷰 점검표](https://github.com/code-review-checklists/java-concurrency)

Go는 CSP에서 몇가지 개념을 채용하여 채널^channel^을 사용하는 새로운 기본요소를
도입하였고  
스레드는 여전히 존재하지만 **고루틴과 채널에서** 모든 것을 모델링하며
**메모리를 공유**한다.

## CSP란 무엇인가?

CSP는 상호작용하는 순차적 프로세스들^Communicating^ ^Sequential^
^Processes^의 약자로  
1978년 찰스 안토니 리차드 호어^Chanrles^ ^Antony^ ^Richard^ ^Hoare^가 미국
계산기 학회에서 논문을 발표했다.  
이 논문에서 호어는 "프로그래밍에서 두 가지 기본 요소인 입력 및 출력이 간과되고
있으며, 특히 동시에 실행되는 코드의 경우에는 더욱 그렇다"  
당시에는 goto 문법의 사용, 객체 지향 패러다임이 싹트기 시작했고 동시성 연산에
대해서는 크게 고려하지 않았다.  
호어가 이를 바로잡기 시작하면서 그의 논문과 CSP가 탄생하였다.

호어는 CSP 프로그래밍 언어에 프로세스 간 입력 및 출력, 즉 통신을 정확하게
모델링하기 위한 기본 요소들을 포함시켰다.  
입력을 요구하고 다른 프로세스가 사용할 출력을 생산하는 로직의 캡슐화된 부분을
**프로세스**라고 지칭했다.

> !: 프로세스에 입력을 보냄  
> ?: 프로세스에 출력을 읽어 옴

| 연산                    | 설명                                                                |
|:-----------------------|:--------------------------------------------------------------------|
| cardreader?cardimage   | cardreader로부터 card를 읽어와서 <br>그 값(문자열) cardimage 변수에 할당 |
| linerprinter!lineimage | linerprinter에 출력을 위한 lineimage 값을 전송                         |

[프로세스간 채널을 사용한 통신 이미지](http://arild.github.io/csp-presentation/#11)


## 동시성을 지원하는 언어의 장점

## Go의 동시성의 철학


