(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{478:function(s,a,t){"use strict";t.r(a);var n=t(2),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("작성 환경")]),s._v(" "),t("p",[s._v("osx catalina"),t("br"),s._v("\ndocker desktop community 2.3.0.4"),t("br"),s._v("\n도커 데몬 CPU 8, memory 2GB"),t("br"),s._v(" "),t("a",{attrs:{href:"https://github.com/yoonhona/study/tree/master/example/docker/cache",target:"_blank",rel:"noopener noreferrer"}},[s._v("사용된 소스 코드"),t("OutboundLink")],1)])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://www.docker.com/sites/default/files/d8/2019-07/horizontal-logo-monochromatic-white.png",alt:""}})]),s._v(" "),t("p",[s._v("일단\n"),t("a",{attrs:{href:"https://create-react-app.dev/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Create React App"),t("OutboundLink")],1),t("sup",[s._v("이하⎺CRA")]),s._v(" 을 사용하여\n간단히 React 프로젝트 세팅을 해보자.")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("npx create-react-app my-app\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" my-app\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# node_modules 크기 확인")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("du")]),s._v(" -hcs node_modules\n247M    node_modules\n247M    total\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("CRA 문서에 따라 my-app이라는 폴더에 설치 후 만들어진 프로젝트 내 설치된 의존성(node_modules) 크기를 확인해보자."),t("br"),s._v("\n247M가 나온다."),t("br"),s._v(" "),t("code",[s._v("머 이정도야")]),s._v(" 일단 한번 도커를 사용하여 빌드하여 이미지를 만들어보자.")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nginx.conf")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("share"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("html"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("htm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try_files")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$uri")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# node alpine 이미지를 base로 하고")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" node"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("alpine as build\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /app 디렉토리 생성 후 프로젝트 폴더를 /app 복사한다.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" /app\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" . /app\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 의존성 설치 후 빌드를 실행")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" yarn\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" yarn build\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 서비스를 실행할 nginx를 alpine 이미지를 base로 하여  ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" nginx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("alpine\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 만들어 놓은 nginx 설정 파일과 위에서 빌드한 결과물을 복사한다. ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" ./nginx.conf /etc/nginx/conf.d\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("from=build /app/build /usr/share/nginx/html\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPOSE")]),s._v(" 80\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-g"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"daemon off;"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br")])]),t("p",[s._v("일단 nginx 환경 설정 파일을 간단하게 만들고,"),t("br"),s._v("\nDockerfile도 간단하게 만들어보자."),t("br"),s._v("\n그리고 "),t("code",[s._v("docker build")]),s._v("하여 시간이 얼마나 걸리는지 살펴보자.")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 시간을 확인하기 위해서 BUILDKIT 활용 ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DOCKER_BUILDKIT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" docker build "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 실행 결과")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("+"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Building "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("113")]),s._v(".4s "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v("/14"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" FINISHED\n "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("internal"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" load build context               "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(".8s\n "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" transferring context: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("152")]),s._v(".55MB           "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(".6s\n "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("blockquote",[t("p",[t("a",{attrs:{href:"https://docs.docker.com/develop/develop-images/build_enhancements/",target:"_blank",rel:"noopener noreferrer"}},[s._v("BuildKit"),t("OutboundLink")],1)])]),s._v(" "),t("p",[s._v("총 113.4초가 걸린것을 확인할 수 있는데 시간을 살펴보기 전에 context라는 것을\n살펴보자."),t("br"),s._v("\ncontext는 도커 빌드 시 대상이 되는 디렉토리로 도커 빌드가 일어나면 도커 데몬에\n복사되게되는데"),t("br"),s._v("\ncontext가 되는 프로젝트 폴더에는 node_modules가 존재하기 때문에 이미 용량이\n많이 커져 있게 된다."),t("br"),s._v("\n이런 파일들을 context에서 제외 시킬 수 있는 "),t("code",[s._v(".dockerignore")]),s._v(" 파일을 설정할\n필요가 있다.")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# .dockerignore")]),s._v("\nnode_modules\nbuild\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DOCKER_BUILDKIT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" docker build "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 실행 결과")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("+"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Building "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("99")]),s._v(".1s "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v("/14"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" FINISHED\n "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("internal"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" load build context      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(".0s\n "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" transferring context: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("509")]),s._v(".52kB  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(".0s\n "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[t("code",[s._v(".dockerignore")]),s._v("에 node_modules와 build 디렉토리를 제외하도록 설정 후 빌드를\n실행하면 불 필요한 파일이 복사되지 않아 context의 크기가 줄어듬을 확인할 수\n있다.")]),s._v(" "),t("p",[s._v("이제 빌드 과정을 살펴보자.")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("+"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Building "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("99")]),s._v(".1s "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v("/14"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" FINISHED\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("build "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("/5"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" WORKDIR /app                             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(".0s\n "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("stage-1 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("/3"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" COPY ./nginx.conf /etc/nginx/conf.d    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(".0s\n "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("build "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("/5"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" COPY "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" /app                              "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(".0s\n "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("build "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("/5"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" RUN "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("yarn")]),s._v("                                "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("90")]),s._v(".8s\n "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("build "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("/5"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" RUN "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("yarn")]),s._v(" build                           "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(".6s\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("한눈에도 알 수 있듯이 의존성 설치 명령이 "),t("code",[s._v("yarn")]),s._v("에서 90초가 넘게 걸렸다."),t("br"),s._v("\n지금 프로젝트에는 가장 기본적인 설정만 되어 있다는 것을 명심하자."),t("br"),s._v("\n앞으로 의존성은 더 늘어나면 늘어나지 줄지는 않을 것이다."),t("br"),s._v("\n그리고 npm 생태계 특성상 프로젝트에서 1개의 의존성을 추가하였다고 해도 1개가 아닐\n가능성이 더 높다.")]),s._v(" "),t("p",[s._v("이제 맨 위에서 "),t("code",[s._v("머 이정도야")]),s._v(" 했던 것이 이정도가 아니게 되어버렸다.")]),s._v(" "),t("p",[s._v("이제 이 부분을 최적화해야 할 것 같은데 이미 여러 최적화 방법이 있고 여기서는\n"),t("a",{attrs:{href:"https://docs.docker.com/develop/develop-images/multistage-build/",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("multi-stage builds")]),t("OutboundLink")],1),s._v("를\n사용하려 한다.")]),s._v(" "),t("p",[s._v("일단 의존성 cache를 위한 부분을 수정해보자.")]),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" node"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("alpine as dependences\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /app 디렉토리 생성 후 프로젝트 폴더를 /app 복사한다.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" /app\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" package.json /app/\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 의존성 설치")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" yarn\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("...")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("변경된 부분을 살펴보면")]),s._v(" "),t("ol",[t("li",[t("code",[s._v("FROM node:alpine as dependences")]),t("br"),s._v("\n처음 FROM 절에 name이 추가되었다. 의존성 cache 후에 프로젝트를 빌드하는\n단계에서 cache를 베이스로 하기 위함이다.")]),s._v(" "),t("li",[t("code",[s._v("COPY package.json /app/")]),t("br"),s._v("\n전체를 복사하지 않고 프로젝트의 의존성을 관리하는 "),t("code",[s._v("package.json")]),s._v("만 복사하도록\n변경되었다."),t("br"),s._v("\nCOPY 명령어로 레이어가 생성될 때는 COPY되는 파일의 변경에 따라 생성이 되는데\n프로젝트 전체 파일을 대상으로 하게되면 프로젝트의 의존성 변경과 관계없이\n레이어가 변경이 되기 때문에 "),t("code",[s._v("package.json")]),s._v("만 복사하게되면 프로젝트 의존성\n변경이 없으면 기존에 빌드된 이미지를 도커가 cache 할 것이다.")])]),s._v(" "),t("p",[s._v("의존성 cache 부분을 변경하면서 빌드를 제외하였기 때문에 빌드 부분을 추가해보면")]),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("...")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" dependences as build\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" . /app\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" yarn build\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("...")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Nginx 부분 동일")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("라인 별로 살펴보면")]),s._v(" "),t("ol",[t("li",[t("code",[s._v("FROM dependences")]),s._v("는 위의 의존성 cache한 부분을 base로 하고 있다."),t("br"),s._v("\n이게 어떻게 동작하는지는 나중에 살펴보자.")]),s._v(" "),t("li",[s._v("나머지 프로젝트내 파일을 복사한다.")]),s._v(" "),t("li",[s._v("빌드를 실행한다.")])]),s._v(" "),t("p",[s._v("크게 바뀐 부분은 의존성 설치와 빌드단계를 나눴다는 것이다."),t("br"),s._v("\n하지만 다들 알다시피 도커 빌드는 위에서 아래로 흐른다."),t("br"),s._v("\n그러면 빌드 단계 앞에 의존성 설치 부분이 존재하기 때문에 빌드 단계에서 의존성\n설치가 진행되지 않을까?"),t("br"),s._v("\n이 부분 도커 빌드를 하면서 살펴보자")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DOCKER_BUILDKIT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" docker build "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" --target"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("dependences -t dependences\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 실행 결과")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("+"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Building "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".4s "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v("/9"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" FINISHED\n "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("internal"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" load build definition from Dockerfile\n "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" transferring dockerfile: 37B\n "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("internal"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" load .dockerignore\n "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" transferring context: 34B\n "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("internal"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" load metadata "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" docker.io/library/node:alpine\n "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("dependences "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/4"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" FROM docker.io/library/node:alpine@sha256:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("internal"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" load build context\n "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" transferring context: 34B\n "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" CACHED "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("dependences "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("/4"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" WORKDIR /app\n "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" CACHED "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("dependences "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("/4"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" COPY package.json /app/\n "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" CACHED "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("dependences "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("/4"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" RUN "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("yarn")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" exporting to image\n "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" exporting layers\n "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" writing image sha256:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" naming to docker.io/library/dependences\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 이미지 검색")]),s._v("\ndocker images "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" dependences\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 이미지 검색 결과")]),s._v("\nREPOSITORY    TAG   IMAGE ID            CREATED             SIZE\ndependences latest  67b2b7604004        About an hour ago   441MB\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br")])]),t("p",[s._v("먼저 의존성 cache를 위해서 빌드를 하였다."),t("br"),s._v("\n빌드 명령어에 두가지가 추가되었는데"),t("br"),s._v(" "),t("code",[s._v("--target=dependences")]),s._v("은 첫 번째 stage인 "),t("code",[s._v("FROM node:alpine as dependences")]),s._v("만 실행하라는 것이고 그렇게 의존성이 설치된 이미지의 tag를 지정하기\n위해 "),t("code",[s._v("-t dependences")]),s._v(" 추가하여 dependences라고 tag를 달아 주었다.")]),s._v(" "),t("p",[s._v("이어서 프로젝트 빌드 단계를 진행하면")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DOCKER_BUILDKIT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" docker build "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" --target"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("build --cache-from"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("dependences -t build\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 결과")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("+"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Building "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(".0s "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("/12"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" FINISHED                                               \n "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("internal"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" load .dockerignore                                            "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(".0s\n "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" transferring context: 34B                                             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(".0s\n "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("internal"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" load build definition from Dockerfile                         "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(".0s\n "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" transferring dockerfile: 37B                                          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(".0s\n "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("internal"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" load metadata "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" docker.io/library/node:alpine               "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".1s\n "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" importing cache manifest from dependences                                "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(".0s\n "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("dependences "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/4"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" FROM docker.io/library/node:alpine@sha256:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(".0s\n "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("internal"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" load build context                                            "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(".0s\n "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" transferring context: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("509")]),s._v(".11kB                                        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(".0s\n "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" CACHED "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("dependences "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("/4"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" WORKDIR /app                                    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(".0s\n "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" CACHED "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("dependences "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("/4"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" COPY package.json /app/                         "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(".0s\n "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" CACHED "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("dependences "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("/4"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" RUN "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("yarn")]),s._v("                                        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(".0s\n "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("build "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" COPY "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" /app                                                  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(".0s\n "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("build "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("/2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" RUN "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("yarn")]),s._v(" build                                               "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(".7s\n "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" exporting to image                                                       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(".0s\n "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" exporting layers                                                      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(".0s\n "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" writing image sha256:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".                                              "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(".0s \n "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" naming to docker.io/library/build                                     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(".0s \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br")])]),t("p",[s._v("여기서는 "),t("code",[s._v("--cache-from=dependences")]),s._v(" 추가되었다.")]),s._v(" "),t("p",[s._v("중간에 이야기 했듯이 도커 빌드는 Dockerfile의 위에서 아래로 흐르기 때문에 의존성\n설치 부분이 이미 빌드가 된 이미지를 참조하기 때문에 13~15라인은 도커에서 cache\n처리된것을 확인 할 수 있다.")]),s._v(" "),t("p",[s._v("그렇기 때문에 90초 이상이 걸리던 의존성 설치부분이 cache되어 0초가 되었다."),t("br"),s._v("\n배포를 위한 빌드 단계의 시간을 절약할 수 있게 되었다."),t("br"),s._v("\n이제 의존성 부분을 이미지화 하는 부분을 CI단계에서 자동화 처리한다면 배포를 위해서\n시간은 더 단축될것이다.")]),s._v(" "),t("hr"),s._v(" "),t("p",[s._v("참고")]),s._v(" "),t("ol",[t("li",[s._v("도커 "),t("a",{attrs:{href:"https://docs.docker.com/storage/storagedriver/",target:"_blank",rel:"noopener noreferrer"}},[s._v("레이어"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://docs.docker.com/develop/develop-images/multistage-build/",target:"_blank",rel:"noopener noreferrer"}},[s._v("multi-stage builds"),t("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=e.exports}}]);